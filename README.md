# 骰子闯关游戏

一个基于 React、Three.js、TypeScript 和 Vite 实现的多人棋盘游戏，支持移动端和桌面端，可横竖屏切换。

## 游戏特色

- **多人对战**：支持 2-6 人同时游戏
- **角色系统**：6 个独特角色，每个角色都有特殊能力
- **事件驱动**：基于事件系统的异步交互机制
- **3D 可视化**：使用 Three.js 实现的 3D 游戏棋盘
- **响应式设计**：完美适配移动端和桌面端，支持横竖屏切换
- **法术卡系统**：多种法术卡提供策略性玩法

## 技术栈

- **前端框架**：React 18
- **3D 渲染**：Three.js
- **开发语言**：TypeScript
- **构建工具**：Vite
- **样式框架**：Tailwind CSS
- **代码规范**：ESLint + Prettier

## 快速开始

### 安装依赖

```bash
npm install
```

### 开发模式

```bash
npm run dev
```

### 构建项目

```bash
npm run build
```

### 预览构建结果

```bash
npm run preview
```

## 游戏玩法

### 基本规则

1. 每个回合玩家可以掷两枚六面骰子，根据点数前进
2. 玩家轮流行动，直到有玩家到达终点
3. 使用法术卡可以获得特殊效果，增加游戏策略性

### 角色系统

游戏中有 6 个独特角色，每个角色都有特殊能力：

- **天命人**：拥有天命之力，每次掷骰子时有一定概率获得额外点数
- **四妹**：擅长策略，可以查看前方一定距离的格子信息
- **猪八戒**：力量强大，可以破坏前方的障碍物
- **大鸟姐姐**：拥有飞行能力，可以跳过一定数量的格子
- **神偷大盗**：擅长偷窃技巧，可以从其他玩家手中获取资源
- **奶昔大哥**：拥有恢复能力，可以治疗自己和其他玩家

### 卡牌系统

#### 功能牌

分为两种类型：
- **能量卡**：提供 1、3、6 不同的能量点数
- **法术卡**：除了提供能量点数外，还有特殊效果

#### 法术卡类型

- **定身术**：指定下次骰子点数
- **交换位置**：与其他玩家交换位置
- **额外回合**：获得额外的行动回合

### 地图格子

游戏地图共有 81 个格子，分为以下类型：

- **空白格**：无特殊效果
- **宝箱格**：玩家抽取一张事件牌
- **反转格**：玩家沿后退方向行进一回合，之后恢复前进方向
- **补给站格**：玩家抽取 2 张功能牌
- **BOSS格**：需要足够能量通过，分布在地图中的 6 个位置
- **传送格**：停留时自动传送到前方最近的空白格子

### BOSS 战斗

- BOSS 格分布在地图中，需要 8、12、12、14、18、20 点能量依次通过
- 成功通过 BOSS 可获得一张功能牌
- 未通过则回到上一个 BOSS 格子（第一个 BOSS 未通过则回到起点）

## 项目结构

```
src/
├── components/          # React 组件
│   ├── DiceRoller.tsx  # 骰子投掷组件
│   ├── GameEventLayer/ # 游戏事件层组件
│   ├── PlayerHand.tsx  # 玩家手牌组件
│   ├── Render.ts       # 3D 渲染组件
│   └── WebGLBoard.tsx  # WebGL 棋盘组件
├── constants/           # 常量定义
│   └── game.ts         # 游戏常量
├── contexts/           # React Context
│   └── GameContext.tsx # 游戏状态管理
├── entities/           # 游戏实体类
│   ├── CardDeck.ts     # 卡牌堆
│   ├── Dice.ts         # 骰子
│   ├── Game.ts         # 游戏主类
│   ├── GameBoard.ts    # 游戏棋盘
│   ├── GameEventSystem.ts # 事件系统
│   ├── Player.ts       # 玩家类
│   └── Tile.ts         # 格子类
└── App.tsx             # 应用主组件
```

## 事件系统

本项目实现了一个基于事件驱动的游戏交互系统，用于处理游戏过程中各种需要等待玩家操作的场景。该系统通过发布/订阅模式，实现了游戏逻辑层与UI渲染层的解耦。

详细使用说明请查看 [事件系统使用说明](./事件系统使用说明.md)。

## 开发指南

### 代码规范

项目使用 ESLint 和 Prettier 进行代码规范检查，提交前请确保代码通过检查：

```bash
npm run lint      # 检查代码规范
npm run format    # 格式化代码
```

### 添加新功能

1. **新增事件类型**：
   - 在 `GameEventSystem.ts` 中添加新的事件类型
   - 在 `GameEventLayer` 目录下创建对应的事件组件
   - 在 `GameEventLayer.tsx` 中注册新事件

2. **新增角色**：
   - 在 `constants/game.ts` 中添加角色信息
   - 在 `Player.ts` 中创建角色类并实现特殊能力

3. **新增格子类型**：
   - 在 `Tile.ts` 中添加新的格子类型
   - 在 `GameBoard.ts` 中实现地图生成逻辑

## 许可证

MIT License